const fs = require('fs');
const path = require('path');

function formatLeaderboard(data) {
  const levels = [
    { key: 'easy', emoji: 'ðŸŸ¢', color: 'ðŸ’š', title: 'ð‘¬ð’‚ð’”ð’š' },
    { key: 'medium', emoji: 'ðŸŸ¡', color: 'ðŸ’›', title: 'ð‘´ð’†ð’…ð’Šð’–ð’Ž' },
    { key: 'hard', emoji: 'ðŸ”´', color: 'â¤ï¸', title: 'ð‘¯ð’‚ð’“ð’…' }
  ];

  let message = `ðŸŽ® ð™ƒð™–ð™£ð™œð™¢ð™–ð™£ â€“ âœ¨ ð“’ð“µð“ªð“¼ð“¼ð“®ð“¶ð“®ð“·ð“½ ð“¹ð“ªð“» ð“­ð“²ð“¯ð“¯ð“²ð“¬ð“¾ð“µð“½Ã© âœ¨\n\n`;

  for (const level of levels) {
    message += `${level.emoji} ${level.title} ã€œâœ¿ã€œ\n`;
    message += `â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n`;

    if (!data[level.key] || data[level.key].length === 0) {
      message += `Aucun joueur pour ce niveau...\n\n`;
      continue;
    }

    const sorted = data[level.key].sort((a, b) => b.wins - a.wins);

    for (let i = 0; i < Math.min(3, sorted.length); i++) {
      const rankEmoji = i === 0 ? 'ðŸ¥‡' : i === 1 ? 'ðŸ¥ˆ' : 'ðŸ¥‰';
      const player = sorted[i];
      message += `${rankEmoji} ${player.name.padEnd(10, ' ')} â”† ${player.wins} victoires ${level.color}\n`;
    }

    message += `\n`;
  }

  message += `âž³ Tape ~hangman stats pour voir tes propres victoires ! Ù©(â—•â€¿â—•)Û¶`;
  return message;
}

module.exports = {
  config: {
    name: 'hangmantop',
    version: '1.0.1',
    role: 0,
    category: 'game',
    shortDescription: 'Classement par difficultÃ© du jeu du pendu',
    author: 'á áŽ¯ážáŽ á‹áŽ¡áŽ¥á£-ã‚·ï¸Žï¸Ž'
  },

  onChat: async function ({ message }) {
    try {
      const filePath = path.resolve(__dirname, 'hangmanData.json');
      if (!fs.existsSync(filePath)) {
        return message.reply("ðŸ“› Aucune donnÃ©e de classement trouvÃ©e.");
      }

      const rawData = fs.readFileSync(filePath, 'utf8');
      const hangmanData = JSON.parse(rawData);

      const leaderboardMessage = formatLeaderboard(hangmanData);
      return message.reply(leaderboardMessage);
    } catch (error) {
      console.error('Erreur lors de la lecture du classement :', error);
      return message.reply("âŒ Une erreur est survenue lors de la rÃ©cupÃ©ration du classement.");
    }
  }
};
